{"version":3,"file":"order-map.js","sources":["../src/OrderMap.ts"],"sourcesContent":["import { IObject } from \"@daybrush/utils\";\n\n/**\n *\n */\nclass OrderMap<T = number | string> {\n    public orderMap: IObject<T[]> = {};\n\n    /**\n     *\n     */\n    constructor(private separator: string) { }\n\n    /**\n     *\n     */\n    public getFullName(names: T[]) {\n        return names.join(this.separator);\n    }\n\n    /**\n     *\n     */\n    public get(names: T[]): T[] | undefined {\n        return this.orderMap[this.getFullName(names)];\n    }\n\n    /**\n     *\n     */\n    public gets(names: T[], isFull = true): T[][] {\n        const fullOrders: T[][] = [];\n        const self = this;\n        function pushOrders(nextNames: T[], stack: T[]) {\n            const orders = self.get(nextNames);\n\n            if (!orders) {\n                return;\n            }\n            orders.forEach(name => {\n                const nextStack = [...stack, name];\n                const nextOrders = pushOrders([...nextNames, name], nextStack);\n\n                if (!nextOrders || !nextOrders.length) {\n                    fullOrders.push([...stack, name]);\n                }\n            });\n            return orders;\n        }\n\n        pushOrders(names, isFull ? names : []);\n\n        return fullOrders;\n    }\n\n    /**\n     *\n     */\n    public set(names: T[], orders: T[]): T[] {\n        names.forEach((name, i) => {\n            this.addName(names.slice(0, i), name);\n        });\n        this.orderMap[this.getFullName(names)] = orders;\n\n        return orders;\n    }\n\n    /**\n     *\n     */\n    public add(names: T[]): T[] {\n        const length = names.length;\n\n        if (!length) {\n            return [];\n        }\n        return this.addName(names.slice(0, -1), names[length - 1]);\n    }\n\n    /**\n     *\n     */\n    public addName(names: T[], name: T): T[] {\n        const orders = this.get(names) || this.set(names, []);\n\n        if (orders.indexOf(name) === -1) {\n            orders.push(name);\n        }\n        return orders;\n    }\n\n    /**\n     *\n     */\n    public findIndex(names: T[], orderName: T): number {\n        const orders = this.orderMap[this.getFullName(names)];\n\n        if (!orders) {\n            return -1;\n        }\n        return orders.indexOf(orderName);\n    }\n\n    /**\n     *\n     */\n    public remove(names: T[]): this {\n        const fullName = this.getFullName(names);\n        const orderMap = this.orderMap;\n\n        for (const name in orderMap) {\n            if (name.indexOf(fullName) === 0) {\n                delete orderMap[name];\n            }\n        }\n        const length = names.length;\n\n        if (length) {\n            const prevNames = names.slice(0, -1);\n            const lastName = names[length - 1];\n\n            this.splice(prevNames, this.findIndex(prevNames, lastName), 1);\n        }\n        return this;\n    }\n\n    /**\n     *\n     */\n    public filter(\n        names: T[],\n        callback: (value: T[], index: number, arr: T[][]) => boolean,\n        isFull = true,\n    ) {\n        const result = this.gets(names, isFull).filter(callback);\n        const map = new OrderMap<T>(this.separator);\n        const stack = isFull ? [] : names;\n\n        result.forEach(nextNames => {\n            map.add([...stack, ...nextNames]);\n        });\n\n        return map;\n    }\n\n    /**\n     *\n     */\n    public splice(names: T[], index: number, deleteCount: number, ...orders: T[]) {\n        const currentOrders = this.get(names) || this.set(names, []);\n\n        currentOrders.splice(index, deleteCount, ...orders);\n\n        return this;\n    }\n\n    /**\n     *\n     */\n    public clear() {\n        this.orderMap = {};\n    }\n\n    /**\n     *\n     */\n    public setObject(obj: IObject<T[]>) {\n        const orderMap = this.orderMap;\n\n        for (const name in obj) {\n            orderMap[name] = obj[name].slice();\n        }\n    }\n    /**\n     *\n     */\n    public getObject(): IObject<T[]> {\n        const nextMap = {};\n\n        const orderMap = this.orderMap;\n        for (const name in orderMap) {\n            nextMap[name] = orderMap[name].slice();\n        }\n        return nextMap;\n    }\n    /**\n     *\n     */\n    public clone() {\n        const map = new OrderMap<T>(this.separator);\n\n        map.setObject(map.orderMap);\n        return map;\n    }\n}\n\nexport default OrderMap;\n"],"names":["separator","names","join","orderMap","getFullName","isFull","fullOrders","self","pushOrders","nextNames","stack","orders","get","forEach","name","nextStack","nextOrders","length","push","i","_this","addName","slice","set","indexOf","orderName","fullName","prevNames","lastName","splice","findIndex","callback","result","gets","filter","map","OrderMap","add","index","deleteCount","_i","currentOrders","obj","nextMap","setObject"],"mappings":"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"}